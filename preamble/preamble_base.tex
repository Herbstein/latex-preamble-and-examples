%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%    Papersize and encoding    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Size of margins can be changed here in the outcommented version!
%\usepackage[a4paper, total={6in, 8in}]{geometry}    %total={width, height}
\usepackage[a4paper]{geometry}

% Basics: font, codec etc.
\usepackage[utf8]{inputenc}                               % encoding: utf-8 (nordic letters)
\usepackage[T1]{fontenc}                                  % use 8-bit encoded fonts
\renewcommand{\sfdefault}{phv}                            % changes the default font

%\usepackage[parfill]{parskip}                            % instead of indenting on a newline adds whitespace



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%      Tables and figures      %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{tabularx,booktabs,authblk}                     % various basic stuff for tables and more

% Figures and captions
\usepackage{caption}                                       % create captions for figures
\usepackage{subfig}                                        % create subfigures of a figure
%\usepackage{subcaption}                                   % create captions for subfigures
                                                           %     currently off, due to conflicts

\usepackage{wrapfig}                                       % letting figures be in text

\usepackage{rotating}                                      % let any environment be rotated (figures sideways)
                                                           %     \begin{sideways} or \begin{turn}{30}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%           Variables              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{pgfkeys}                                       % Initialize the variable key-value parirs

\newcommand{\setvalue}[1]{\pgfkeys{/variables/#1}}
\newcommand{\getvalue}[1]{\pgfkeysvalueof{/variables/#1}}
\newcommand{\declare}[1]{%
 \pgfkeys{
  /variables/#1.is family,
  /variables/#1.unknown/.style = {\pgfkeyscurrentpath/\pgfkeyscurrentname/.initial = ##1}
 }%
}

\declare{}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%      LaTeX Programming       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{xparse}                                         % Scanning arguments
\usepackage{xifthen}                                        % Conditionals
\usepackage{xstring}                                        % String functions
\usepackage{calc}                                           % Calculations



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%          Hypermedia          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{url, hyperref}                                  % \url{link} and \href{link}{replacing text}

%Macros taken from the preamble of the MatFysTutor LaTeX Guide.
\newcommand*{\http}[1]{\href{http://#1}{#1}}                % macro for http links: \http{www.matfystutor.dk}
\newcommand*{\mailto}[1]{\href{mailto:#1}{#1}}              % macro for mails: \mailto{email@email.com}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%         Stylization          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Headers og footers
\usepackage{lastpage}                                        % \lastpage command for numbers of pages
\usepackage{fancyhdr}                                        % create cool headers and footers
\pagestyle{fancy}                                            % who doesn't want their page to be fancy?

% Use of columns
\usepackage{multicol}

% Quotations
% "danish" or "british"
\usepackage[danish=guillemets]{csquotes}                     % two styles: "quotes" or >>guillemets<<
%\MakeAutoQuote{»}{«}                                        % decomment for easy macro
%\MakeAutoQuote*{›}{‹}                                       % decomment for even easier macros

% Like a paragraph, but adds also a linebreak after. (Also is not recorded on labelling)
\newcommand{\lbparagraph}[1]{\vspace{0.3em} \noindent \textbf{#1}\\ \noindent}

% Underlining and strikethrough text
\usepackage[normalem]{ulem}

% Text above/below other text (toplap)
\usepackage{stackengine}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             Math             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\newcommand{\hmmax}{0}                                        % minimizes the amount of bold families
%\newcommand{\bmmax}{1}                                        % this allows for more math families

% various basic stuff
\usepackage{mathtools, amsmath}
\allowdisplaybreaks                                            % allow pagebreaks in align*

% other math goodies
\usepackage{cancel}

% Various symbol packages
\usepackage{amssymb}
\usepackage[utopia]{mathdesign}                                % full overwrite of the font system
\usepackage{stmaryrd}                                          % even more symbols

\DeclareMathAlphabet{\mathpzc}{OT1}{pzc}{m}{it}                % \mathpzc a less pompous curly typeset

% Math shortcuts
\renewcommand{\d}{\, \mathrm{d}}                               % \d = differential d with a bit of spacing
\newcommand{\e}{\mathrm{e}}                                    % \e = eulers number
\newcommand{\R}{\mathbb{R}}                                    % \R = Real numbers
\newcommand{\N}{\mathbb{N}}                                    % \N = Natural numbers
\newcommand{\Z}{\mathbb{Z}}                                    % \Z = Integers
\newcommand{\C}{\mathbb{C}}                                    % \C = Complex numbers
\newcommand{\Q}{\mathbb{Q}}                                    % \Q = Rational numbers
\newcommand{\F}{\mathbb{F}}                                    % \F = Field
\newcommand{\K}{\mathbb{K}}                                    % \K = Field \R and \C
\newcommand{\V}{\mathpzc{V}}                                   % \V
\newcommand{\W}{\mathpzc{W}}                                   % \W
\renewcommand{\S}{\mathbb{S}}                                  % \S = Set of permutations

\newcommand{\Id}{\text{Id}}                                    % \Id = Identity function

\newcommand{\Det}[1]{\text{Det}\left( #1 \right)}              % \Det{arg}             Det(arg)
\newcommand{\Span}[1]{\text{Span}\left( #1 \right)}            % \Span{arg}            Span(arg)
\newcommand{\sgn}[1]{\text{sgn} \left( #1 \right)}             % \sgn{arg}             sgn(arg)
\newcommand{\adj}[1]{\text{adj} \left( #1 \right)}             % \adj{arg}             adj(arg)
\newcommand{\ord}[1]{\text{ord} \left( #1 \right)}             % \ord{arg}             ord(arg)

\newcommand{\abs}[1]{\left\lvert #1 \right\rvert}              % \abs{arg}             absolute/modulo of value
\newcommand{\norm}[1]{\left\lVert #1 \right\rVert}             % \norm{arg}            norm of a value
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}             % \ceil{arg}            ceiling of a value
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}          % \floor{arg}           floor of a value
\newcommand{\inprod}[2]{\left\langle #1 , #2 \right\rangle}    % \inprod{v}{w}         inner product
\newcommand{\powgroup}[1]{\left\langle #1 \right\rangle}       % \powgroup{arg}        image of f={g^n | n in Z}

\newcounter{i}

\DeclareDocumentCommand \set { m g g }{               % \set{X}{C}{|}
     \left\lbrace                                     % {X | C}
         #1 \IfValueT {#2} { \ \IfValueTF{#3}{#3}{|}\  #2 }
     \right\rbrace
}

\DeclareDocumentCommand \seq { g g g g } {            % \seq{x}{i}{j}{s}
    \setcounter{i}{0}                                 % x_i, x_i+s, ... x_j
    \IfValueT {#2} { \addtocounter{i}{#2} }
    \IfValueTF {#1}
        {#1}
        {x}
    _{ \arabic{i} },
    \IfValueTF {#4} 
        {\addtocounter{i}{#4}}
        {\addtocounter{i}{1}}
    \IfValueTF {#1} 
        {#1}
        {x} 
    _{ \arabic{i} },
    \dots
    \IfValueTF {#3}
        { , #1_{#3} }
        {}
}

\DeclareDocumentCommand \eqclass { g g }{         % \eqclass{v}{V}    Equivalent Class
    \left[                                        % This can also be used for coordinate vectors
        \IfValueTF{#1}
            {#1}
            {\dot}
    \right]
    \IfValueTF{#2}
            {_{#2}}
            {}
}

\DeclareDocumentCommand \ero { g g } {            % \ero {x, y}
    \begin{array}{c}                              %    x
        \IfValueTF{#1}                            %    ~
            {_{#1}}                               %    y
            {\phantom{\sim}}
    \\
        \sim
    \\
        \IfValueTF{#2}
            {^{#2}}
            {\phantom{\sim}}
    \end{array}
}

\DeclareDocumentCommand \matrep { g g g } {       % \matrep{W}{L}{V}    Matrixrepresentation
    {_{                                           % W[L]V
        \IfValueTF {#1}                           %No arguments for W or V results in standardbasis
            {#1}                                  %No arguments for L results in coordinatetransformation
            {\epsilon}
    }}
    \left[
        \IfValueTF {#2}
            {#2}
            {\square}
    \right] {_{
        \IfValueTF {#3}
            {#3}
            {\epsilon}
    }}
}

\newcommand{\IndexedFunc}[3]{{#1}_{#2} \left( #3 \right)}

\DeclareDocumentCommand \Geo { g g }{            % \Geo{v}{V}    Geogrebic Multiplicity
    \IndexedFunc
        {\text{Geo}}
        {\IfValueTF{#1}
                {#1}
                {L}}
        {\IfValueTF{#2}
            {#2}
            {\lambda}}
}

\DeclareDocumentCommand \Alg { g g }{             % \Alg            Algebraic Multiplicity
    \IndexedFunc
        {\text{Alg}}
        {\IfValueTF{#1}
                {#1}
                {L}}
        {\IfValueTF{#2}
            {#2}
            {\lambda}}
}

\DeclareDocumentCommand \series { g g g g }{      % \series{a}{b}{c}{d}		\{ a_b \} _{b = c} ^d
    \set{\IfValueTF{#1}							  %    An infinite series with elements a, indexed by b
			{#1}								  %    starting from c ending at d
			{a}
		 _{\IfValueTF{#2}
		 	{#2}
		 	{n}}    	
    	}
    	_{\IfValueTF{#2}
    		{#2}
    		{n}
    	 =
    	 \IfValueTF{#3}
    		{#3}
    		{1}
    	}
    	^{\IfValueTF{#4}
    		{#4}
    		{\infty}
    	}
}

\DeclareDocumentCommand \pseries { g g g g }{     % \pseries{a}{b}{c}{d}		\{ x^k \} _{k = c} ^d
    \set{\IfValueTF{#1}							  %    An infinite series of points x, indexed by k
			{#1}								  %    starting from c ending at d
			{x}
		 ^{\IfValueTF{#2}
		 	{#2}
		 	{k}}    	
    	}
    	_{\IfValueTF{#2}
    		{#2}
    		{k}
    	 =
    	 \IfValueTF{#3}
    		{#3}
    		{1}
    	}
    	^{\IfValueTF{#4}
    		{#4}
    		{\infty}
    	}
}
\renewcommand{\|}{\scalebox{1.3}{|}\ }                           % Larger vertical bar for divisors
\renewcommand{\div}[1]{\text{div}\left( #1 \right)}            % div(arg)

\makeatletter                                      % adds vertical lines to matrices
\renewcommand*\env@matrix[1][*\c@MaxMatrixCols c]{
  \hskip -\arraycolsep
  \let\@ifnextchar\new@ifnextchar
  \array{#1}}
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%      Logic and proofs        %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Proofs
\usepackage{amsthm}                                % Theorem package
\theoremstyle{definition}                          % plain, definition, remark
%\swapnumbers                                      % If you want to have the number first

% Logic packages
\usepackage{lplfitch}                              % fitch style proofs

%\usepackage{logicproof}                           % alternative package, resembling the dBerLog book
%\setlength\subproofhorizspace{2em}                % Indent for subproofs. Changed for fresh variables



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%      Color and presets       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\usepackage{xcolor}                               % basic xcolor package
\usepackage[table,xcdraw]{xcolor}                  % xcolor package with support for tables
\usepackage{colortbl}                              % color presets working together with xcolor

\definecolor{lstComment}{rgb}{0.45,0.45,0.45}      % code: comments (Grey)
\definecolor{lstKey}{rgb}{0.13,0.21,1}             % code: primary keywords (Blue)
\definecolor{lstKey2}{rgb}{1,0.666667,0.13726}     % code: secondary keywords (Day[9] Orange)
\definecolor{lstString}{rgb}{0.1,0.65,0.1}         % code: strings (Green)
\definecolor{lstBase}{rgb}{0.0,0.0,0.0}            % code: base (Black)



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%            Tikz              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{tikz}                                % import basepackage
\usetikzlibrary{calc}                            % Coordinate calcuations
\usetikzlibrary{positioning}                     % Relative positioning
\usetikzlibrary{shapes}                          % Defining nodeshapes and more (isa for E/R)

% Simple tree macro with compability to tikz
\usepackage{tikz-qtree}                          % import simple tree macro
\usetikzlibrary{arrows}                          % arrows for trees

% Tikz settings for red-black trees
\tikzset{
  treenode/.style = {align=center, inner sep=0pt, text centered,
    font=\sffamily},
  arn_b/.style = {treenode, circle, white, font=\sffamily\bfseries, draw=black,
    fill=black, text width=1.5em},               % black node
  arn_r/.style = {treenode, circle, white, font=\sffamily\bfseries, draw=red,
    fill=red, text width=1.5em},                 % red node
  arn_x/.style = {treenode, rectangle, draw=black, fill=black,
    minimum width=0.5em, minimum height=0.5em}   % nil node
}

% Tikz Automota for Turing Machines
\usetikzlibrary{automata}

% Tikz E/R diagram
\usetikzlibrary{er}

% Graphics and plots
\usepackage{graphicx}                             % import basepackage for graphs
\usepackage{pgfplots}                             % import pgfplots
\usepgfplotslibrary{fillbetween}                  % add fillBetween command
\pgfplotsset{compat=1.10}                         % choose version of pgfplots

% Macro for circle with symbol inside.
\newcommand*\circled[1]{ \tikz[baseline=(C.base)]\node[draw,circle,inner sep=0.5pt](C) {#1};\!}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%            Code              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\code}[1]{{\sf #1}}                    % \code{X} writes X in a code-appropriate font




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%         lstlisting           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Import lstlistings - beautiful sourcecode!
\usepackage{listings}


% Custom language definitions
% Definition of Pseudocode
\lstdefinelanguage{pseudocode}{
  keywords=[1]{
           break, break, by, do, downto, else, error, for, if, repeat, return, to, until, while, while
      },                                           % list of keywords, first and last are not used for some stupid reason
  keywords=[2]{
        and, and, or, NIL, NIL
  }
  sensitive=false,                                 % keywords are not case-sensitive
  morecomment=[l]{//},                             % l is for line comment
  morecomment=[s]{/*}{*/},                         % s is for start and end delimiter
  morestring=[b]"                                  % strings are enclosed in double quotes
}


% Settings for lstlistings
\lstset{
  language=pseudocode,                             % choose language
  columns=flexible,                                % let the box align to the width of the page
    literate={æ}{{\ae}}1{ø}{{\o}}1{å}{{\aa}}1      % allow æ, ø and å in code
           {Æ}{{\AE}}1{Ø}{{\O}}1{Å}{{\AA}}1,       %     (this change was taken from the preamble of the MatFysTutor LaTeX Guide)
  breaklines=true,                                 % automatically break lines
  breakatwhitespace=true,                          % automatically break should there only be white space.
  numbers=left,                                    % numbering: none, left, right
  numbersep=5pt,                                   % distance between linenumbers and code
  numberstyle=\color{lstComment},                  % change style of numbering - currently grey.
  stepnumber=1,                                    % step between to line-numbers. 1 = each line is numbered
  showspaces=false,                                % show spaces everywhere - adding particular underscores
  showstringspaces=false,                          % underline spaces within strings only.
  showtabs=false,                                  % show tabs within strings adding particular underscores.
  escapeinside={*@}{@*},                           % if you want to add LaTeX within your code
  basicstyle=\ttfamily \color{lstBase},            % set basic color
  commentstyle=\color{lstComment},                 % set color of comments
  keywordstyle=[1]\color{lstKey},                  % set color of primary keywords
  keywordstyle=[2]\color{lstKey2},                 % set color of secondary keywords
  stringstyle=\color{lstString},                   % set color of strings
}

% lstlisting - Put it beautifully in the middle
\lstset{
  xleftmargin= .1\textwidth ,                                       % leftmargin being 10% of the current width
  xrightmargin= .1\textwidth,                                       % right margin also 10%
  frame=bottomline                                                  % Draw a line on the bottom of the surrounding box
}

% lstlisting caption setup - minimalistic
\lstset{
  frame=top,frame=bottom,
  captionpos=b
}

% lstlisting header/caption by Rasmus Skovdal
%\DeclareCaptionFont{white}{\color{white}}                                       % fontstyle of caption
%\DeclareCaptionFormat{listing}{\colorbox{gray}{\parbox{\linewidth}{#1#2#3}}}    % create nice grey boxes for captions
%\captionsetup[lstlisting]{format=listing,labelfont=white,textfont=white}        % apply settings to listing


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%      Title and information       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setvalue{title = }
\setvalue{subtitle = }

\DeclareDocumentCommand \settitle { m g }{                 % \setTitle{title}{subtitle}
     \setvalue{title = #1}
     \IfValueTF {#2} { \setvalue{subtitle = #2} \title{\huge \getvalue{title} \\ \large \getvalue{subtitle}}}
                      { \title{\huge \getvalue{title}} }
}

\DeclareDocumentCommand \addauth { m g g }{                % \addAuth{name}{email}{id}
     \IfValueT {#3} {                                      % Set the id text as desired on the top left
         \setvalue{id = #3}
     }
     \pgfkeysifdefined{/variables/name}{
         \setvalue{id = \, et al}
     }{
         \setvalue{name = #1}
     }     
     \author{#1}
     \IfValueT {#2} {
        \pgfkeysifdefined{/variables/email}{
            % Do Nothing
        }{
             \setvalue{email = #2}
         }
         \IfValueTF {#3} {
         	\affil{#3, \protect\href{mailto:#2}{#2}}
         }
         {
         	\affil{\protect\href{mailto:#2}{#2}}
         }
     }
}

\settitle{Keep Calm and \textbackslash settitle}

\date{\today}

%Headers:
%  Unused pieces of code
%     Name of writers   \protect\href{\getvalue{email}}{\getvalue{name}\getvalue{id}}
%     "of X pages"      \getvalue{of} \pageref{LastPage}

%Odd pages (Main for onesided)

\fancyhead[RO]{\thepage}
\fancyhead[LO]{\getvalue{title}}

%Even pages
\fancyhead[RE]{\nouppercase{\leftmark}}
\fancyhead[LE]{\thepage}

%Nothing below
\fancyfoot[LCR]{}
